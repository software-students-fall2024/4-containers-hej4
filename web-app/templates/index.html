{% extends "base.html" %}
{% block container %}
<section>
    <section class="game-container">
        <section class="game">
            <h2>Player: 0</h2>
            <div class="choice">
                <video id="camera" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
            </div>
            <button id="btn">GO!</button>
            <!-- populate with choice for each round -->
            <p>✊✋✌️</p>
        </section>
        <section class="game">
            <h2>Computer: 0</h2>
            <div class="choice">
                <p id="comp-choice">✊</p>
            </div>
            <!-- populate with choice for each round -->
            <p>✊✋✌️</p>
        </section>
    </section>
</section>
<script>
    const video = document.querySelector("#camera");
    const canvas = document.querySelector("#canvas");
    const btn = document.querySelector("#btn");
    
    async function startCamera(){
        const constraints = {
            audio: false,
            video: { width: 400, height: 400 },
        };
        try {
            let stream = await navigator.mediaDevices.getUserMedia(constraints);
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                video.play();
            };
        }
        catch (err) {
            console.error("Error accessing camera:", err);
        }
    }

    function takePicture() {
        const context = canvas.getContext("2d");
        canvas.width = 400;
        canvas.height = 400;
        context.drawImage(video, 0, 0, 400, 400);

        const imageData = canvas.toDataURL("image/png");
        postImageData(imageData);
    }

    function postImageData(imageData){
        fetch("http://127.0.0.1:5000/upload_image", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ image: imageData }),
        })
    }

    window.addEventListener("load", startCamera);
    btn.addEventListener("click", (e)=>{e.preventDefault(); takePicture();})

</script>
{% endblock %}